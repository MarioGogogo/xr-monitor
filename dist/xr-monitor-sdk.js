!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).XrMonitor=t()}(this,function(){"use strict";function t(t,e){var n,o=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)),o}function i(o){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?t(Object(r),!0).forEach(function(e){var t,n;t=o,n=r[e=e],(e=a(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(r,e))})}return o}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,a(o.key),o)}}function r(e,t,n){t&&o(e.prototype,t),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1})}function a(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);if("object"!=typeof(n=n.call(e,t||"default")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}function u(e){return e.split("\n").slice(1).map(function(e){return e.replace(/^\s+at\s+/g,"")}).join("^")}function s(e){return e.reverse().filter(function(e){return e!==document&&e!==window}).map(function(e){return e.id?"".concat(e.nodeName.toLowerCase(),"#").concat(e.id):e.className&&"string"==typeof e.className?"".concat(e.nodeName.toLowerCase(),".").concat(e.className):e.nodeName.toLowerCase()}).join(" ")}function l(e){if(Array.isArray(e))return s(e);for(var t=[];e;)t.push(e),e=e.parentNode;return s(t)}function p(e){return e?(e=e[0].document.activeElement).classList+"_"+e.id+"_"+e.localName:""}var c={iPad:/ipad/i,iPhone:/iphone/i,"Windows Vista":/windows nt 6\.0/i,"Windows 7":/windows nt 6\.\d+/i,"Windows 2003":/windows nt 5\.2+/i,"Windows XP":/windows nt 5\.1+/i,"Windows 2000":/windows nt 5\.0+/i,"OS X $1.$2":/os x (\d+)[._](\d+)/i,Linux:/linux/i,Googlebot:/googlebot/i},d=Object.keys(c);var m=["opera","konqueror","firefox","chrome","epiphany","safari","msie","curl"];var g={version:"1.0.4",parse:function(e){var t={full:e,name:function(e){e=e.toLowerCase();for(var t=0,n=m.length;t<n;++t)if(-1!==e.indexOf(m[t]))return m[t];return""}(e)};return t.version=function(e,t){"safari"===t&&(t="version");return t?new RegExp(t+"[\\/ ]([\\d\\w\\.-]+)","i").exec(e)&&RegExp.$1||"":(t=e.match(/version[\/ ]([\d\w\.]+)/i))&&1<t.length?t[1]:""}(e,t.name),t.fullName=t.name+" "+t.version,t.os=function(e){for(var n,t=0,o=d.length;t<o;++t)if(n=c[d[t]].exec(e))return~d[t].indexOf("$1")?d[t].replace(/\$(\d+)/g,function(e,t){return n[t]}):d[t];return""}(e),t}};function w(){return{timestamp:(new Date).getTime(),reportTime:(e=(new Date).getFullYear(),t=(new Date).getMonth()+1,n=(new Date).getDate(),o=(new Date).getHours(),r=(new Date).getMinutes()<10?"0"+(new Date).getMinutes():(new Date).getMinutes(),i=(new Date).getSeconds()<10?"0"+(new Date).getSeconds():(new Date).getSeconds(),"".concat(e,"-").concat(t,"-").concat(n," ").concat(o,":").concat(r,":").concat(i)),projectName:document.title,host:"127.0.0.1",url:location.href,userAgent:g.parse(navigator.userAgent).fullName,borwser:g.parse(navigator.userAgent).name,client:g.parse(navigator.userAgent).os};var e,t,n,o,r,i}var h,v=new(function(){function e(){n(this,e),this.url="https://egg-v1.fml.ink/logs",this.xhr=new XMLHttpRequest}return r(e,[{key:"send",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=i(i({},w()),t);for(e in n)"number"==typeof n[e]&&(n[e]="".concat(n[e]));console.table(n);t=JSON.stringify({__logs__:[n]});navigator.sendBeacon?navigator.sendBeacon(this.url,t):(this.xhr.open("POST",this.url,!0),this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.setRequestHeader("x-log-apiversion","0.6.0"),this.xhr.setRequestHeader("x-log-bodyrawsize",t.length),this.xhr.onload=function(){},this.xhr.onerror=function(e){},this.xhr.send(t))}}]),e}());function y(){var n=Date.now(),o="";function e(o){var r=window.history[o];return function(e){var t=r.apply(this,arguments),n=new Event(o);return n.arguments=arguments,window.dispatchEvent(n),t}}function t(){e=Date.now(),t=e-n,n=e;var e=t,t=window.location.href;console.log("%c Line:63 🥔 页面停留时间","font-size:18px;color:#ffffff;background:#CC9966",o+" | "+t+"|"+e),o=t}window.addEventListener("pushState",function(){t()}),window.addEventListener("replaceState",function(){t()}),window.history.pushState=e("pushState"),window.history.replaceState=e("replaceState"),window.addEventListener("load",function(){t()}),window.addEventListener("unload",function(){t()}),window.addEventListener("popstate",function(){t()})}function b(){var n=Date.now(),o="";function e(){e=Date.now(),t=e-n,n=e;var e=t,t=window.location.href;console.log("%c Line:63 🥔 页面停留时间","font-size:18px;color:#ffffff;background:#CC9966",o+" | "+t+"|"+e),o=t}window.addEventListener("hashchange",function(){e()}),window.addEventListener("load",function(){e()});var r,i;window.history.pushState=(r="pushState",i=window.history[r],function(e){var t=i.apply(this,arguments),n=new Event(r);return n.arguments=arguments,window.dispatchEvent(n),t}),window.addEventListener("pushState",function(){e()})}function E(){var p,d,e;PerformanceObserver&&(new PerformanceObserver(function(e,t){e=e.getEntries();p=e[0],t.disconnect()}).observe({entryTypes:["element"]}),new PerformanceObserver(function(e,t){e=e.getEntries();d=e[0],t.disconnect()}).observe({entryTypes:["largest-contentful-paint"]}),new PerformanceObserver(function(e,t){["click","touchstart","mousedown","keydown","mouseover"].forEach(function(e){document.addEventListener(e,function(e){n=e},{capture:!0,passive:!0})});var n,o,r,i=n,e=e.getEntries()[0];console.log("%c Line:25 🍆 FID","font-size:18px;color:#ffffff;background:#FFCC99",e),e&&(o=e.processingStart-e.startTime,r=e.duration,0<o||0<r)&&(console.log("%c Line:30 👨🏻‍🏫 首次输入延迟日志上报","font-size:18px;color:#ffffff;background:#c23616"),v.send({type:"performance",eventType:"firstInputDelay",inputDelay:o,duration:r,startTime:e.startTime,selector:i?l(i.path||i.target):""})),t.disconnect()}).observe({type:"performance",buffered:!0})),e=function(){setTimeout(function(){var e=performance.timing,t=e.fetchStart,n=e.connectStart,o=e.connectEnd,r=e.requestStart,i=e.responseStart,a=e.responseEnd,s=e.domLoading,c=e.domInteractive,f=e.domContentLoadedEventStart,u=e.domContentLoadedEventEnd,e=e.loadEventStart,o=(v.send({type:"performance",eventType:"timing",connectTime:o-n,ttfbTime:i-r,responseTime:a-i,parseDOMTime:e-s,domContentLoadedTime:u-f,timeToInteractive:c-t,loadTIme:e-t}),performance.getEntriesByName("first-paint")[0]),n=performance.getEntriesByName("first-contentful-paint")[0];v.send({type:"performance",eventType:"paint",firstPaint:o?o.startTime:"",firstContentfulPaint:n?n.startTime:"",firstMeaningfulPaint:p?p.startTime:"",largestContentfulPaint:d?d.startTime:""})},3e3)},"complete"===document.readyState?e():window.addEventListener("load",e)}function j(e){var t,c,r,n=e.jsError,o=e.promiseError,i=e.vueError;e.performance,n&&(t=e,window.addEventListener("error",function(e){console.log("%c Line:12 🍪 path","font-size:18px;color:#ffffff;background:#CC9966",e.composedPath()),e.target&&(e.target.src||e.target.href)?v.send({projectName:t.projectName,type:"error",errorType:"resourceError",filename:e.target.src||e.target.href,tagName:e.target.tagName,selector:l(e.target)}):v.send({projectName:t.projectName,type:"error",errorType:"jsError",message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:u(e.error.stack),selector:e.composedPath?p(e.composedPath()):""})},!0)),o&&(c=e,window.addEventListener("unhandledrejection",function(e){console.log(e);var t,n,o,r=0,i=0,a="",s=e.reason;"string"==typeof s?o=s:"object"===f(s)&&(o=s.message,s.stack&&(n=(t=s.stack.match(/at\s+(.+):(\d+):(\d+)/))[1],r=t[2],i=t[3]),a=u(s.stack)),v.send({projectName:c.projectName,type:"error",errorType:"promiseError",message:o,filename:n,lineno:r,colno:i,stack:a,selector:e.composedPath?p(e.composedPath()):""})},!0)),i&&(r=e,Vue.config.errorHandler=function(e,t,n){console.log("%c Line:4 🌰 error, vm, info","font-size:18px;color:#ffffff;background:#7f8fa6",e,t,n);try{var o={projectName:r.projectName,message:e.message,stack:e.stack,info:n};"[object Object]"===Object.prototype.toString.call(t)&&(o.componentName=t._isVue?t.$options.name||t.$options._componentTag:t.name,o.propsData=t.$options.propsData),v.send({type:"error",errorType:"vueError",message:JSON.stringify(o)})}catch(e){console.log("%c Line:21 🍣 vueError","font-size:18px;color:#ffffff;background:#FF6666",e)}})}function S(e){var u,o,t;e.actionLogs&&(u=e,e=window.XMLHttpRequest,o=e.prototype.open,e.prototype.open=function(e,t,n){return t.match(/sockjs/)||t.match(/logs/)||(this.logData={method:e,url:t,async:n}),o.apply(this,arguments)},t=e.prototype.send,e.prototype.send=function(s){var c,e,f=this;return this.logData&&(c=Date.now(),this.addEventListener("load",(e=function(a){return function(e){var t,n=Date.now()-c-2,o=f.status,r=f.statusText,i="";i=!s||""===(t=void 0===(t=JSON.parse(s).method)?"":t)?f.logData.url.split("/").slice(-2).join("/"):t,v.send({projectName:u.projectName,type:"xhr",eventType:a,pathname:f.logData.url,status:o+"-"+r,method:i||"",duration:n,response:f.response?JSON.stringify(f.response):"",request:s||""})}})("load"),!1),this.addEventListener("error",e("error"),!1),this.addEventListener("abort",e("abort"),!1)),t.apply(this,arguments)})}return(h=function(){function t(e){n(this,t),this.options=e,this.init()}return r(t,[{key:"init",value:function(){console.log("xrMonitor初始化成功");var e=this.options;if(!e)throw new Error("options不能为空");if(""===e.url)throw new Error("url不能为空");if(e.vueError&&""==e.vue)throw new Error("vue实例不能为空");j(this.options),S(this.options),this.options.performanceLogs&&E(),this.options.pageRouter&&(b(),y())}},{key:"report",value:function(e){console.log("init options",this.options);var t,n,o,r,e=i(i({},this.options),e);t=(e=e).projectName,n=e.type,o=e.method,r=e.request,e=e.response,v.send({projectName:t,type:"xhr",eventType:n,method:o||"",duration:"",response:e?JSON.stringify(e):"",request:r?JSON.stringify(r):""})}}]),t}()).init=function(e){return new h(e)},h});
