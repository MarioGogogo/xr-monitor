!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).XrMonitor=t()}(this,function(){"use strict";function t(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function i(r){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?t(Object(o),!0).forEach(function(e){var t,n;t=r,n=o[e=e],(e=a(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))})}return r}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,a(r.key),r)}}function o(e,t,n){t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1})}function a(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);if("object"!=typeof(n=n.call(e,t||"default")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}function p(e){return e.split("\n").slice(1).map(function(e){return e.replace(/^\s+at\s+/g,"")}).join("^")}function s(e){return e.reverse().filter(function(e){return e!==document&&e!==window}).map(function(e){return e.id?"".concat(e.nodeName.toLowerCase(),"#").concat(e.id):e.className&&"string"==typeof e.className?"".concat(e.nodeName.toLowerCase(),".").concat(e.className):e.nodeName.toLowerCase()}).join(" ")}function l(e){if(Array.isArray(e))return s(e);for(var t=[];e;)t.push(e),e=e.parentNode;return s(t)}function f(e){return e?(e=e[0].document.activeElement).classList+"_"+e.id+"_"+e.localName:""}var c={iPad:/ipad/i,iPhone:/iphone/i,"Windows Vista":/windows nt 6\.0/i,"Windows 7":/windows nt 6\.\d+/i,"Windows 2003":/windows nt 5\.2+/i,"Windows XP":/windows nt 5\.1+/i,"Windows 2000":/windows nt 5\.0+/i,"OS X $1.$2":/os x (\d+)[._](\d+)/i,Linux:/linux/i,Googlebot:/googlebot/i},d=Object.keys(c);var m=["opera","konqueror","firefox","chrome","epiphany","safari","msie","curl"];var h={version:"1.0.4",parse:function(e){var t={full:e,name:function(e){e=e.toLowerCase();for(var t=0,n=m.length;t<n;++t)if(-1!==e.indexOf(m[t]))return m[t];return""}(e)};return t.version=function(e,t){"safari"===t&&(t="version");return t?new RegExp(t+"[\\/ ]([\\d\\w\\.-]+)","i").exec(e)&&RegExp.$1||"":(t=e.match(/version[\/ ]([\d\w\.]+)/i))&&1<t.length?t[1]:""}(e,t.name),t.fullName=t.name+" "+t.version,t.os=function(e){for(var n,t=0,r=d.length;t<r;++t)if(n=c[d[t]].exec(e))return~d[t].indexOf("$1")?d[t].replace(/\$(\d+)/g,function(e,t){return n[t]}):d[t];return""}(e),t}};function w(){return{timestamp:(new Date).getTime(),reportTime:(e=(new Date).getFullYear(),t=(new Date).getMonth()+1,n=(new Date).getDate(),r=(new Date).getHours(),o=(new Date).getMinutes()<10?"0"+(new Date).getMinutes():(new Date).getMinutes(),i=(new Date).getSeconds()<10?"0"+(new Date).getSeconds():(new Date).getSeconds(),"".concat(e,"-").concat(t,"-").concat(n," ").concat(r,":").concat(o,":").concat(i)),projectName:document.title,host:"127.0.0.1",url:location.href,userAgent:h.parse(navigator.userAgent).fullName,borwser:h.parse(navigator.userAgent).name,client:h.parse(navigator.userAgent).os};var e,t,n,r,o,i}var g,y=new(function(){function e(){n(this,e),this.url="https://egg-v1.fml.ink/logs",this.xhr=new XMLHttpRequest}return o(e,[{key:"send",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=i(i({},w()),t);for(e in n)"number"==typeof n[e]&&(n[e]="".concat(n[e]));t=JSON.stringify({__logs__:[n]});navigator.sendBeacon?navigator.sendBeacon(this.url,t):(this.xhr.open("POST",this.url,!0),this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.setRequestHeader("x-log-apiversion","0.6.0"),this.xhr.setRequestHeader("x-log-bodyrawsize",t.length),this.xhr.onload=function(){},this.xhr.onerror=function(e){},this.xhr.send(t))}}]),e}());function v(){function e(r){var o=window.history[r];return function(e){var t=o.apply(this,arguments),n=new Event(r);return n.arguments=arguments,window.dispatchEvent(n),t}}window.addEventListener("pushState",function(){}),window.addEventListener("replaceState",function(){}),window.history.pushState=e("pushState"),window.history.replaceState=e("replaceState"),window.addEventListener("load",function(){}),window.addEventListener("unload",function(){}),window.addEventListener("popstate",function(){})}function b(){var f,d,e;PerformanceObserver&&(new PerformanceObserver(function(e,t){e=e.getEntries();f=e[0],t.disconnect()}).observe({entryTypes:["element"]}),new PerformanceObserver(function(e,t){e=e.getEntries();d=e[0],t.disconnect()}).observe({entryTypes:["largest-contentful-paint"]}),new PerformanceObserver(function(e,t){["click","touchstart","mousedown","keydown","mouseover"].forEach(function(e){document.addEventListener(e,function(e){n=e},{capture:!0,passive:!0})});var n,r,o,i=n,e=e.getEntries()[0];e&&(r=e.processingStart-e.startTime,o=e.duration,0<r||0<o)&&y.send({type:"performance",eventType:"firstInputDelay",inputDelay:r,duration:o,startTime:e.startTime,selector:i?l(i.path||i.target):""}),t.disconnect()}).observe({type:"performance",buffered:!0})),e=function(){setTimeout(function(){var e=performance.timing,t=e.fetchStart,n=e.connectStart,r=e.connectEnd,o=e.requestStart,i=e.responseStart,a=e.responseEnd,s=e.domLoading,c=e.domInteractive,u=e.domContentLoadedEventStart,p=e.domContentLoadedEventEnd,e=e.loadEventStart,r=(y.send({type:"performance",eventType:"timing",connectTime:r-n,ttfbTime:i-o,responseTime:a-i,parseDOMTime:e-s,domContentLoadedTime:p-u,timeToInteractive:c-t,loadTIme:e-t}),performance.getEntriesByName("first-paint")[0]),n=performance.getEntriesByName("first-contentful-paint")[0];y.send({type:"performance",eventType:"paint",firstPaint:r?r.startTime:"",firstContentfulPaint:n?n.startTime:"",firstMeaningfulPaint:f?f.startTime:"",largestContentfulPaint:d?d.startTime:""})},3e3)},"complete"===document.readyState?e():window.addEventListener("load",e)}function E(e){var t,c,o,n=e.jsError,r=e.promiseError,i=e.vueError;e.performance,n&&(t=e,window.addEventListener("error",function(e){e.target&&(e.target.src||e.target.href)?y.send({projectName:t.projectName,type:"error",errorType:"resourceError",filename:e.target.src||e.target.href,tagName:e.target.tagName,selector:l(e.target)}):y.send({projectName:t.projectName,type:"error",errorType:"jsError",message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:p(e.error.stack),selector:e.composedPath?f(e.composedPath()):""})},!0)),r&&(c=e,window.addEventListener("unhandledrejection",function(e){var t,n,r,o=0,i=0,a="",s=e.reason;"string"==typeof s?r=s:"object"===u(s)&&(r=s.message,s.stack&&(n=(t=s.stack.match(/at\s+(.+):(\d+):(\d+)/))[1],o=t[2],i=t[3]),a=p(s.stack)),y.send({projectName:c.projectName,type:"error",errorType:"promiseError",message:r,filename:n,lineno:o,colno:i,stack:a,selector:e.composedPath?f(e.composedPath()):""})},!0)),i&&(o=e,Vue.config.errorHandler=function(e,t,n){try{var r={projectName:o.projectName,message:e.message,stack:e.stack,info:n};"[object Object]"===Object.prototype.toString.call(t)&&(r.componentName=t._isVue?t.$options.name||t.$options._componentTag:t.name,r.propsData=t.$options.propsData),y.send({type:"error",errorType:"vueError",message:JSON.stringify(r)})}catch(e){}})}function j(e){var p,r,t;e.actionLogs&&(p=e,e=window.XMLHttpRequest,r=e.prototype.open,e.prototype.open=function(e,t,n){return t.match(/sockjs/)||t.match(/logs/)||(this.logData={method:e,url:t,async:n}),r.apply(this,arguments)},t=e.prototype.send,e.prototype.send=function(s){var c,e,u=this;return this.logData&&(c=Date.now(),this.addEventListener("load",(e=function(a){return function(e){var t,n=Date.now()-c-2,r=u.status,o=u.statusText,i="";i=!s||""===(t=void 0===(t=JSON.parse(s).method)?"":t)?u.logData.url.split("/").slice(-2).join("/"):t,y.send({projectName:p.projectName,type:"xhr",eventType:a,pathname:u.logData.url,status:r+"-"+o,method:i||"",duration:n,response:u.response?JSON.stringify(u.response):"",request:s||""})}})("load"),!1),this.addEventListener("error",e("error"),!1),this.addEventListener("abort",e("abort"),!1)),t.apply(this,arguments)})}function S(e){var r,o;e.pageRouter&&(window.addEventListener("hashchange",function(){}),window.addEventListener("load",function(){}),window.history.pushState=(r="pushState",o=window.history[r],function(e){var t=o.apply(this,arguments),n=new Event(r);return n.arguments=arguments,window.dispatchEvent(n),t}),window.addEventListener("pushState",function(){}),v())}return(g=function(){function t(e){n(this,t),this.options=e,this.init()}return o(t,[{key:"init",value:function(){var e=this.options;if(!e)throw new Error("options不能为空");if(""===e.url)throw new Error("url不能为空");if(e.vueError&&""==e.vue)throw new Error("vue实例不能为空");E(this.options),j(this.options),this.options.performanceLogs&&b(),S(this.options)}},{key:"report",value:function(e){var t,n,r,o,e=i(i({},this.options),e);t=(e=e).projectName,n=e.type,r=e.method,o=e.request,e=e.response,y.send({projectName:t,type:"xhr",eventType:n,method:r||"",duration:"",response:e?JSON.stringify(e):"",request:o?JSON.stringify(o):""})}}]),t}()).init=function(e){return new g(e)},g});
